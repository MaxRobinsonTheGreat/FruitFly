!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=5)}([function(t,e,i){const s=i(2);t.exports={getImageContainer:function(){if(this.instance)return this.instance;this.image_map=new Map,this.loaded_image_counter=0,this.outdated_sprites=[],this.loadImages()},loadImages:function(){for(let t of s){let e=new Image;e.onload=(()=>{this.imageLoaded()}),e.src="./img/"+t.src,t.img=e,this.image_map.set(t.title,t)}images_info=[]},imageLoaded:function(){this.loaded_image_counter++==images_info.length&&this.updateSprites()},updateSprites:function(){for(let t of this.outdated_sprites)t.imageFinished()},get:function(t){return this.image_map.get(t)},pushOutDated:function(t){this.outdated_sprites.push(t)}}},function(t,e){t.exports=class{constructor(){this.location={x:20,y:20},this.dimensions={l:100,w:50},this.center=this.getCenter(),this.commands={left:!1,right:!1,up:!1,down:!1},this.speed=100,this.last_update=Date.now(),this.orientation=0}getCenter(){return{x:this.location.x+this.dimensions.w/2,y:this.location.y+this.dimensions.l/2}}move(t){var e=Object.assign({},this.location),i=t/1e3*this.speed;return this.commands.left&&(this.location.x-=i),this.commands.right&&(this.location.x+=i),this.commands.up&&(this.location.y-=i),this.commands.down&&(this.location.y+=i),e}setOrientation(t,e){this.center=this.getCenter();let i=t-this.center.x,s=e-this.center.y,n=180/Math.PI;if(0!==i)if(i>0&&s<0){let t=Math.atan(-s/-i)*n;this.orientation=t+360}else if(i>0&&s>0)this.orientation=Math.atan(s/i)*n;else if(i<0&&s>0){let t=Math.atan(s/i)*n;this.orientation=t+180}else if(i<0&&s<0){let t=Math.atan(s/i)*n;this.orientation=t+180}}}},function(t,e,i){"use strict";t.exports=[{title:"Alien",src:"Alien.png",type:"sprite",rows:4,cols:4,fps:5},{title:"Person",src:"character.png",type:"sprite",rows:2,cols:8,fps:10},{title:"Pixels",src:"movers.png",type:"sprite",rows:3,cols:2,fps:4}]},function(t,e,i){"use strict";const s=i(0);t.exports=class{constructor(t,e,i){let n=s.get(t),o=e.l,r=e.w;this.container={h:o,w:r},this.resize_factor=i,this.rows=n.rows,this.cols=n.cols,this.ctx=n.ctx,this.wait_time=1e3/n.fps,this.img=n.img,this.cur_frame=0,this.cur_row=0,this.srcX=0,this.srcY=0,this.last_update_time=Date.now(),this.off_set_x=0,this.off_set_y=0,this.img.complete?(this.frame_width=this.img.width/this.cols,this.frame_height=this.img.height/this.rows,this.width=this.frame_width,this.height=this.frame_height,this.resize_factor&&this.resizeBy(this.resize_factor),this.center()):s.pushOutDated(this)}imageFinished(){this.frame_width||(this.frame_width=this.img.width/this.cols,this.frame_height=this.img.height/this.rows),this.width=this.frame_width,this.height=this.frame_height,this.resize_factor&&this.resizeBy(this.resize_factor),this.container&&this.center()}resizeTo(t,e){this.width=e,this.height=t}resizeBy(t){this.width=this.frame_width*t,this.height=this.frame_height*t,Math.round(this.height),Math.round(this.width),this.resize_factor=t}center(){this.off_set_x=this.container.w/2-this.width/2,this.off_set_y=this.container.h/2-this.height/2}setRow(t){t<0||t>=this.rows||(this.cur_row=t,this.srcY=this.cur_row*this.frame_height)}updateFrame(){Date.now()-this.last_update_time<this.wait_time||(this.last_update_time=Date.now(),++this.cur_frame>=this.cols&&(this.cur_frame=0),this.srcX=this.cur_frame*this.frame_width)}drawDirectional(t,e,i){i>=315||i<=45?this.setRow(2):i>45&&i<=135?this.setRow(0):i>135&&i<=225?this.setRow(1):this.setRow(3),this.draw(t,e)}draw(t,e){this.img.complete&&(this.updateFrame(),ctx.drawImage(this.img,this.srcX,this.srcY,this.frame_width,this.frame_height,t+this.off_set_x,e+this.off_set_y,this.width,this.height))}drawStatic(t,e,i,s){this.img.complete&&(this.srcX=s*this.frame_width,this.srcY=i*this.frame_height,ctx.drawImage(this.img,this.srcX,this.srcY,this.frame_width,this.frame_height,t+this.off_set_x,e+this.off_set_y,this.width,this.height))}}},function(t,e,s){s(1);t.exports={getLocationObj:function(t,e){return{x:t,y:e}},getDimensionsObj:function(t,e){return{l:t,w:e}},getCommandsObj:function(){return{left:!1,right:!1,up:!1,down:!1}},checkBoundry:function(t,e){var i=!1;return t.x+e.w>600&&(t.x=600-e.w,i=!0),t.y+e.l>400&&(t.y=400-e.l,i=!0),t.x<0&&(t.x=0,i=!0),t.y<0&&(t.y=0,i=!0),{loc:t,was_correction:i}},checkIntersect:function(t,e){let i=t.location,s=t.dimensions,n=e.location,o=e.dimensions;return i.x+s.w>n.x&&i.x<n.x+o.w&&i.y+s.l>n.y&&i.y<n.y+o.l},anyIntersect:function(t,e,s){for(i in e)if(i!=s&&this.checkIntersect(t,e[i]))return!0;return!1},connection:function(){return"core module connected"}}},function(t,e,i){"use strict";const s=i(4),n=i(3),o=i(1);i(0).getImageContainer();var r=60,a=0,h=0,c=new o;c.sprite=new n("Alien",c.dimensions,2);var l,f=[],m=-1,d=0,u=0,g=[],p=100,w=0,_=!1,y=io.connect();function x(t,e){let i=l.state.locations[t],s=g[0].state.locations[t],n=g[0].timestamp-l.timestamp;0!==n&&(f[t].location.x+=(s.x-i.x)/n*(e-p-l.timestamp),f[t].location.y+=(s.y-i.y)/n*(e-p-l.timestamp))}function v(t){if(f.length!==t.locations.length)for(var e in f=[],t.locations){f.push({location:t.locations[e],dimensions:s.getDimensionsObj(100,50)});var i=new n("Person",f[e].dimensions,.5);f[e].sprite=i}else for(var e in f)f[e].location=t.locations[e];m=t.self_index}function b(t,e){ctx.fillStyle=e,ctx.fillRect(t.location.x,t.location.y,t.dimensions.w,t.dimensions.l)}y.on("connect",function(t){document.addEventListener("keydown",I),document.addEventListener("keyup",j),d=Date.now(),setInterval(function(){u=Date.now()-d,d=Date.now(),function(){var t=c.move(u);s.anyIntersect(c,f,m)&&(c.location=t);var e=s.checkBoundry(c.location,c.dimensions);c.location=e.loc,c.setOrientation(a,h)}(),function(){if(void 0===l||void 0===g)return;if(v(l.state),0===g.length)return;let t=Date.now();for(var e in f){if(e>=g[0].state.locations.length)break;if(e!=m)x(e,t);else{var i=g[g.length-1].state.self_index;f[e].location=g[g.length-1].state.locations[i]}}for(;g.length>0&&t-g[0].timestamp>=p;)l=g.shift()}(),y.emit("move",{loc:c.location,cc:w}),function(){for(var t in ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height),b(c,"blue"),c.sprite.drawDirectional(c.location.x,c.location.y,c.orientation),f)(t!=m||_&&t<f.length)&&(b(f[t],"red"),f[t].sprite.draw(f[t].location.x,f[t].location.y));ctx.beginPath(),ctx.moveTo(c.center.x,c.center.y),ctx.lineTo(a,h),ctx.stroke()}(ctx)},1e3/r),y.emit("init_client",c.location)}),y.on("all",function(t){void 0===l?(v(t),l={state:t,timestamp:Date.now()}):g.push({state:t,timestamp:Date.now()})}),y.on("correction",function(t){t.cc===w&&(c.location=t.corrected_location,w++)});const D=87,k=83,O=65,C=68;function I(t){t.preventDefault(),t.keyCode===O&&(c.commands.left=!0),t.keyCode===C&&(c.commands.right=!0),t.keyCode===D&&(c.commands.up=!0),t.keyCode===k&&(c.commands.down=!0)}function j(t){t.preventDefault(),t.keyCode===O&&(c.commands.left=!1),t.keyCode===C&&(c.commands.right=!1),t.keyCode===D&&(c.commands.up=!1),t.keyCode===k&&(c.commands.down=!1)}$("body").mousemove(function(t){var e=canvas.getBoundingClientRect();a=t.clientX-e.left,h=t.clientY-e.top})}]);