{"code":"!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,\"a\",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p=\"\",n(n.s=4)}([function(t,e){t.exports=class{constructor(){this.location={x:20,y:20},this.dimensions={l:100,w:50},this.center=this.getCenter(),this.commands={left:!1,right:!1,up:!1,down:!1},this.speed=100,this.last_update=Date.now(),this.orientation=0}getCenter(){return{x:this.location.x+this.dimensions.w/2,y:this.location.y+this.dimensions.l/2}}move(t){var e=Object.assign({},this.location),n=t/1e3*this.speed;return this.commands.left&&(this.location.x-=n),this.commands.right&&(this.location.x+=n),this.commands.up&&(this.location.y-=n),this.commands.down&&(this.location.y+=n),e}setOrientation(t,e){this.center=this.getCenter();let n=t-this.center.x,o=e-this.center.y,i=180/Math.PI;if(0!==n)if(n>0&&o<0){let t=Math.atan(-o/-n)*i;this.orientation=t+360}else if(n>0&&o>0)this.orientation=Math.atan(o/n)*i;else if(n<0&&o>0){let t=Math.atan(o/n)*i;this.orientation=t+180}else if(n<0&&o<0){let t=Math.atan(o/n)*i;this.orientation=t+180}}}},function(t,e,n){\"use strict\";t.exports=[{title:\"Alien\",src:\"Alien.png\",type:\"sprite\",rows:4,cols:4,fps:5},{title:\"Person\",src:\"character.png\",type:\"sprite\",rows:2,cols:8,fps:10},{title:\"Pixels\",src:\"movers.png\",type:\"sprite\",rows:3,cols:2,fps:4}]},function(t,e,n){const o=n(1);t.exports={getImageContainer:function(){if(this.instance)return this.instance;this.image_map=new Map,this.loaded_image_counter=0,this.outdated_sprites=[],this.loadImages()},loadImages:function(){for(let t of o){let e=new Image;e.onload=(()=>{this.imageLoaded()}),e.src=\"./img/\"+t.src,t.img=e,this.image_map.set(t.title,t)}images_info=[]},imageLoaded:function(){this.loaded_image_counter++==images_info.length&&this.updateSprites()},updateSprites:function(){for(let t of this.outdated_sprites)t.imageFinished()},get:function(t){return this.image_map.get(t)},pushOutDated:function(t){this.outdated_sprites.push(t)}}},function(t,e,n){n(0);t.exports={getLocationObj:function(t,e){return{x:t,y:e}},getDimensionsObj:function(t,e){return{l:t,w:e}},getCommandsObj:function(){return{left:!1,right:!1,up:!1,down:!1}},checkBoundry:function(t,e){var n=!1;return t.x+e.w>600&&(t.x=600-e.w,n=!0),t.y+e.l>400&&(t.y=400-e.l,n=!0),t.x<0&&(t.x=0,n=!0),t.y<0&&(t.y=0,n=!0),{loc:t,was_correction:n}},checkIntersect:function(t,e){let n=t.location,o=t.dimensions,i=e.location,s=e.dimensions;return n.x+o.w>i.x&&n.x<i.x+s.w&&n.y+o.l>i.y&&n.y<i.y+s.l},anyIntersect:function(t,e,n){for(i in e)if(i!=n&&this.checkIntersect(t,e[i]))return!0;return!1},connection:function(){return\"core module connected\"}}},function(t,e,n){\"use strict\";const o=n(3),i=n(!function(){var t=new Error(\"Cannot find module '/rendering/sprite'\");throw t.code=\"MODULE_NOT_FOUND\",t}()),s=n(0);n(2).getImageContainer();var a=60,r=0,c=0,l=new s;l.sprite=new i(\"Alien\",l.dimensions,2);var u,d=[],f=-1,m=0,h=0,p=[],g=100,y=0,x=!1,v=io.connect();function w(t,e){let n=u.state.locations[t],o=p[0].state.locations[t],i=p[0].timestamp-u.timestamp;0!==i&&(d[t].location.x+=(o.x-n.x)/i*(e-g-u.timestamp),d[t].location.y+=(o.y-n.y)/i*(e-g-u.timestamp))}function _(t){if(d.length!==t.locations.length)for(var e in d=[],t.locations){d.push({location:t.locations[e],dimensions:o.getDimensionsObj(100,50)});var n=new i(\"Person\",d[e].dimensions,.5);d[e].sprite=n}else for(var e in d)d[e].location=t.locations[e];f=t.self_index}function b(t,e){ctx.fillStyle=e,ctx.fillRect(t.location.x,t.location.y,t.dimensions.w,t.dimensions.l)}v.on(\"connect\",function(t){document.addEventListener(\"keydown\",j),document.addEventListener(\"keyup\",I),m=Date.now(),setInterval(function(){h=Date.now()-m,m=Date.now(),function(){var t=l.move(h);o.anyIntersect(l,d,f)&&(l.location=t);var e=o.checkBoundry(l.location,l.dimensions);l.location=e.loc,l.setOrientation(r,c)}(),function(){if(void 0===u||void 0===p)return;if(_(u.state),0===p.length)return;let t=Date.now();for(var e in d){if(e>=p[0].state.locations.length)break;if(e!=f)w(e,t);else{var n=p[p.length-1].state.self_index;d[e].location=p[p.length-1].state.locations[n]}}for(;p.length>0&&t-p[0].timestamp>=g;)u=p.shift()}(),v.emit(\"move\",{loc:l.location,cc:y}),function(){for(var t in ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height),b(l,\"blue\"),l.sprite.drawDirectional(l.location.x,l.location.y,l.orientation),d)(t!=f||x&&t<d.length)&&(b(d[t],\"red\"),d[t].sprite.draw(d[t].location.x,d[t].location.y));ctx.beginPath(),ctx.moveTo(l.center.x,l.center.y),ctx.lineTo(r,c),ctx.stroke()}(ctx)},1e3/a),v.emit(\"init_client\",l.location)}),v.on(\"all\",function(t){void 0===u?(_(t),u={state:t,timestamp:Date.now()}):p.push({state:t,timestamp:Date.now()})}),v.on(\"correction\",function(t){t.cc===y&&(l.location=t.corrected_location,y++)});const O=87,k=83,C=65,D=68;function j(t){t.preventDefault(),t.keyCode===C&&(l.commands.left=!0),t.keyCode===D&&(l.commands.right=!0),t.keyCode===O&&(l.commands.up=!0),t.keyCode===k&&(l.commands.down=!0)}function I(t){t.preventDefault(),t.keyCode===C&&(l.commands.left=!1),t.keyCode===D&&(l.commands.right=!1),t.keyCode===O&&(l.commands.up=!1),t.keyCode===k&&(l.commands.down=!1)}$(\"body\").mousemove(function(t){var e=canvas.getBoundingClientRect();r=t.clientX-e.left,c=t.clientY-e.top})}]);","extractedComments":[]}